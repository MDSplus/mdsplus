#! /bin/sh
cd $(dirname $0)

unset abort
testprog() {
# $1 prog, $2 package
if ! which $1 >/dev/null 2>&1
then
	export abort=$?
	echo "Please install package providing '$1' in order to bootstrap"
	shift
	echo "The required package may be named $@."
	echo "We recommend using docker if available:"
	echo "  deploy/build.sh --os=bootstrap"
fi
}

test2prog() {
# $1 prog1, $2 prog2, package


if ! which $1 >/dev/null 2>&1 && ! which $2 >/dev/null 2>&1
then
        export abort=$?
        echo "Please install package providing '$1' or '$2' in order to bootstrap"
        shift
        echo "The required package may be named $@."
        echo "We recommend using docker if available:"
        echo "  deploy/build.sh --os=bootstrap"
fi
}

testprog aclocal	automake
testprog autoheader	autoconf
testprog automake	automake
testprog autoconf	autoconf
testprog2 python2 python3 python2 or python3
testprog bison		bison
testprog flex		flex

if [ ! -z $abort ]
then
	exit $abort
fi

conf/update_submodules

aclocal -I ./m4

autoheader

# libtoolize

automake --add-missing

autoconf

python deploy/gen_messages.py
python deploy/gen_compound_opcbuiltins.py

deploy/yylex.gen tdishr
deploy/yylex.gen mdsdcl
